<html lang="en">
<head>
<meta charset="utf-8" />
<title>Search Players and Teams on Eliteprospects.com </title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<style>
  .ui-menu .ui-menu-item .ui-corner-all {
    font-weight: bold;      
  }

  .ui-menu .ui-menu-item .ui-corner-all .matches {
    font-weight: normal;      
  }
  #log {
    margin-top: 2em;
  }
</style>

<script type="text/javascript">
    
  $(function() {


    var endpoint = "http://api.eliteprospects.com/v1";
    
    /**
     * Builds the eliteprospects url for a player.
     */
    function getPlayerURI(playerId) {
      return "http://www.eliteprospects.com/player.php?player="+playerId;
    }

    /**
     * Builds the eliteprospects url for a team.
     */
    function getTeamURI(teamId) {
      return "http://www.eliteprospects.com/team.php?team="+teamId;
    }  

    /*
     * Helper function to print messages to the log box
     */
    function log( message ) {
      $( "<div>" ).text( message ).prependTo( "#log" );
      $( "#log" ).scrollTop( 0 );
    }
   
    /**
     * Function that uses the returned matches-array to style effected chars.
     */
    function highlightEffect(type, item) {
      
      var tmp = '';
      var stopChar;
      var counter = 0;
      var name = '';

      if(type == "team") {
        name = item.fullteam;
      } else {
        name = item.fullname;
      }


      item.matches.forEach(function(entry) {
        if(counter == 0)
        {
            tmp = name.substr(0, entry[0]);
            counter++;
        }
        if(stopChar < entry[0])
        {
            tmp = tmp + name.substr(stopChar, entry[0]-stopChar);
        }

        tmp = tmp + "<span class='matches'>" + name.substr(entry[0], entry[1]-entry[0]) + "</span>";
        stopChar = entry[1];
      });

      return tmp + name.substring(stopChar, name.length);    
    }

    /*
     * Autocomplete function for players
     */
    $( "#player" ).autocomplete({
      source: function(request, response) {
        $.getJSON(endpoint + "/players", { q: request.term }, response);
      },      
      minLength: 2,
      delay: 100,
      select: function( event, ui ) {
        log( ui.item ?
          ui.item.fullname + ": " + getPlayerURI(ui.item.id):
          "Nothing selected, input was " + this.value );
        return false;
      }
    }).data( "ui-autocomplete" )._renderItem = function( ul, item ) {      
      
      var name = highlightEffect("player", item);     
      return $( "<li>" )
        .append( "<a>" + name + " (" + item.position + ") </a>" )
        .appendTo( ul );
    };

     /*
     * Autocomplete function for teams
     */
    $( "#team" ).autocomplete({
      source: function(request, response) {
        $.getJSON(endpoint + "/teams", { q: request.term }, response);
      },      
      minLength: 2,
      delay: 100,
      select: function( event, ui ) {
        log( ui.item ?
          ui.item.fullteam + ": " + getTeamURI(ui.item.id):
          "Nothing selected, input was " + this.value );
        return false;
      }
    }).data( "ui-autocomplete" )._renderItem = function( ul, item ) {      
      
      var name = highlightEffect("team", item);     
      return $( "<li>" )
        .append( "<a>" + name + "</a>" )
        .appendTo( ul );
    };
  });
</script>
</head>

<body>

<div class="ui-widget">
  <label for="player">Search player: </label>
  <input id="player" />
  <label for="team">Search team: </label>
  <input id="team" />
</div>

<div id="log"></div>
 
</body>
</html>
